<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: DICOM::DObject</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">DICOM::DObject</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/dicom/DObject_rb.html">
                lib/dicom/DObject.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Class for interacting with the <a href="../DICOM.html">DICOM</a> object.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000028">children</a>&nbsp;&nbsp;
      <a href="#M000020">encode_segments</a>&nbsp;&nbsp;
      <a href="#M000030">get_bin</a>&nbsp;&nbsp;
      <a href="#M000024">get_frames</a>&nbsp;&nbsp;
      <a href="#M000021">get_image</a>&nbsp;&nbsp;
      <a href="#M000023">get_image_magick</a>&nbsp;&nbsp;
      <a href="#M000022">get_image_narray</a>&nbsp;&nbsp;
      <a href="#M000025">get_image_pos</a>&nbsp;&nbsp;
      <a href="#M000026">get_pos</a>&nbsp;&nbsp;
      <a href="#M000029">get_value</a>&nbsp;&nbsp;
      <a href="#M000027">image_to_file</a>&nbsp;&nbsp;
      <a href="#M000017">new</a>&nbsp;&nbsp;
      <a href="#M000031">parents</a>&nbsp;&nbsp;
      <a href="#M000033">print</a>&nbsp;&nbsp;
      <a href="#M000032">print_all</a>&nbsp;&nbsp;
      <a href="#M000034">print_properties</a>&nbsp;&nbsp;
      <a href="#M000018">read</a>&nbsp;&nbsp;
      <a href="#M000039">remove</a>&nbsp;&nbsp;
      <a href="#M000040">remove_private</a>&nbsp;&nbsp;
      <a href="#M000035">set_image</a>&nbsp;&nbsp;
      <a href="#M000036">set_image_file</a>&nbsp;&nbsp;
      <a href="#M000037">set_image_magick</a>&nbsp;&nbsp;
      <a href="#M000038">set_image_narray</a>&nbsp;&nbsp;
      <a href="#M000041">set_value</a>&nbsp;&nbsp;
      <a href="#M000019">write</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">bin</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">errors</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">lengths</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">levels</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">modality</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">names</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">read_success</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">segments</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">tags</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">values</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">vr</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">write_success</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(string=nil, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initialize the <a href="DObject.html">DObject</a> instance.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
    <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 40</span>
40:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">string</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">options</span>={})
41:       <span class="ruby-comment cmt"># Process option values, setting defaults for the ones that are not specified:</span>
42:       <span class="ruby-ivar">@verbose</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:verbose</span>]
43:       <span class="ruby-identifier">segment_size</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:segment_size</span>]
44:       <span class="ruby-identifier">bin</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:bin</span>]
45:       <span class="ruby-identifier">syntax</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:syntax</span>]
46:       <span class="ruby-comment cmt"># Default verbosity is true:</span>
47:       <span class="ruby-ivar">@verbose</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@verbose</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
48: 
49:       <span class="ruby-comment cmt"># Initialize variables that will be used for the DICOM object:</span>
50:       <span class="ruby-ivar">@names</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
51:       <span class="ruby-ivar">@tags</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
52:       <span class="ruby-ivar">@vr</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
53:       <span class="ruby-ivar">@lengths</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
54:       <span class="ruby-ivar">@values</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
55:       <span class="ruby-ivar">@bin</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
56:       <span class="ruby-ivar">@levels</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
57:       <span class="ruby-comment cmt"># Array that will holde any messages generated while reading the DICOM file:</span>
58:       <span class="ruby-ivar">@errors</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
59:       <span class="ruby-comment cmt"># Array to keep track of sequences/structure of the dicom elements:</span>
60:       <span class="ruby-ivar">@sequence</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
61:       <span class="ruby-comment cmt"># Structural information (default values):</span>
62:       <span class="ruby-ivar">@compression</span> = <span class="ruby-keyword kw">false</span>
63:       <span class="ruby-ivar">@color</span> = <span class="ruby-keyword kw">false</span>
64:       <span class="ruby-ivar">@explicit</span> = <span class="ruby-keyword kw">true</span>
65:       <span class="ruby-ivar">@file_endian</span> = <span class="ruby-keyword kw">false</span>
66:       <span class="ruby-comment cmt"># Information about the DICOM object:</span>
67:       <span class="ruby-ivar">@modality</span> = <span class="ruby-keyword kw">nil</span>
68:       <span class="ruby-comment cmt"># Control variables:</span>
69:       <span class="ruby-ivar">@read_success</span> = <span class="ruby-keyword kw">false</span>
70:       <span class="ruby-comment cmt"># Initialize a Stream instance which is used for encoding/decoding:</span>
71:       <span class="ruby-ivar">@stream</span> = <span class="ruby-constant">Stream</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">nil</span>, <span class="ruby-ivar">@file_endian</span>, <span class="ruby-ivar">@explicit</span>)
72: 
73:       <span class="ruby-comment cmt"># If a (valid) file name string is supplied, call the method to read the DICOM file:</span>
74:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">string</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">string</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
75:         <span class="ruby-ivar">@file</span> = <span class="ruby-identifier">string</span>
76:         <span class="ruby-identifier">read</span>(<span class="ruby-identifier">string</span>, <span class="ruby-identifier">:bin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bin</span>, <span class="ruby-identifier">:segment_size</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">segment_size</span>, <span class="ruby-identifier">:syntax</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">syntax</span>)
77:       <span class="ruby-keyword kw">end</span>
78:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000028" class="method-detail">
        <a name="M000028"></a>

        <div class="method-heading">
          <a href="#M000028" class="method-signature">
          <span class="method-name">children</span><span class="method-args">(element, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the positions of all data elements inside the hierarchy of a
sequence or an item. Options: :next_only =&gt; true - The method will only
search immediately below the specified item or sequence (that is, in the
level of parent + 1).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000028-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000028-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 422</span>
422:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">options</span>={})
423:       <span class="ruby-comment cmt"># Process option values, setting defaults for the ones that are not specified:</span>
424:       <span class="ruby-identifier">opt_next_only</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:next_only</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>
425:       <span class="ruby-identifier">children_pos</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
426:       <span class="ruby-comment cmt"># Retrieve array position:</span>
427:       <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">element</span>)
428:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
429:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Invalid data element provided to method children().&quot;</span>)
430:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
431:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Method children() does not allow a query which yields multiple array hits. Please use array position instead of tag/name.&quot;</span>)
432:       <span class="ruby-keyword kw">else</span>
433:         <span class="ruby-comment cmt"># Proceed to find the value:</span>
434:         <span class="ruby-comment cmt"># First we need to establish in which positions to perform the search:</span>
435:         <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
436:           <span class="ruby-identifier">parent_level</span> = <span class="ruby-ivar">@levels</span>[<span class="ruby-identifier">p</span>]
437:           <span class="ruby-identifier">remain_array</span> = <span class="ruby-ivar">@levels</span>[<span class="ruby-identifier">p</span><span class="ruby-operator">+</span><span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-ivar">@levels</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>]
438:           <span class="ruby-identifier">extract</span> = <span class="ruby-keyword kw">true</span>
439:           <span class="ruby-identifier">remain_array</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
440:             <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">remain_array</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">parent_level</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">extract</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>)
441:               <span class="ruby-comment cmt"># If search is targetted at any specific level, we can just add this position:</span>
442:               <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">opt_next_only</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
443:                 <span class="ruby-identifier">children_pos</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">p</span><span class="ruby-operator">+</span><span class="ruby-value">1</span><span class="ruby-operator">+</span><span class="ruby-identifier">i</span>)
444:               <span class="ruby-keyword kw">else</span>
445:                 <span class="ruby-comment cmt"># As search is restricted to parent level + 1, do a test for this:</span>
446:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remain_array</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">parent_level</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
447:                   <span class="ruby-identifier">children_pos</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">p</span><span class="ruby-operator">+</span><span class="ruby-value">1</span><span class="ruby-operator">+</span><span class="ruby-identifier">i</span>)
448:                 <span class="ruby-keyword kw">end</span>
449:               <span class="ruby-keyword kw">end</span>
450:             <span class="ruby-keyword kw">else</span>
451:               <span class="ruby-comment cmt"># If we encounter a position who's level is not deeper than the original level, we can not extract any more values:</span>
452:               <span class="ruby-identifier">extract</span> = <span class="ruby-keyword kw">false</span>
453:             <span class="ruby-keyword kw">end</span>
454:           <span class="ruby-keyword kw">end</span>
455:         <span class="ruby-keyword kw">end</span>
456:       <span class="ruby-keyword kw">end</span>
457:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">children_pos</span>
458:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">encode_segments</span><span class="method-args">(size)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Encodes the <a href="../DICOM.html">DICOM</a> object into a series of
binary string segments with a specified maximum length.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 131</span>
131:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encode_segments</span>(<span class="ruby-identifier">size</span>)
132:       <span class="ruby-identifier">w</span> = <span class="ruby-identifier">set_write_object</span>
133:       <span class="ruby-ivar">@segments</span> = <span class="ruby-identifier">w</span>.<span class="ruby-identifier">encode_segments</span>(<span class="ruby-identifier">size</span>)
134:       <span class="ruby-comment cmt"># Write process succesful?</span>
135:       <span class="ruby-ivar">@write_success</span> = <span class="ruby-identifier">w</span>.<span class="ruby-identifier">success</span>
136:       <span class="ruby-comment cmt"># If any messages has been recorded, send these to the message handling method:</span>
137:       <span class="ruby-identifier">add_msg</span>(<span class="ruby-identifier">w</span>.<span class="ruby-identifier">msg</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">w</span>.<span class="ruby-identifier">msg</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
138:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000030" class="method-detail">
        <a name="M000030"></a>

        <div class="method-heading">
          <a href="#M000030" class="method-signature">
          <span class="method-name">get_bin</span><span class="method-args">(element, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the unprocessed, binary string of the requested <a
href="../DICOM.html">DICOM</a> data element. Data element may be specified
by array position, tag or name. Options: :array =&gt; true - Allows the
query of the (binary) value of a tag that occurs more than one time in the
</p>
<pre>
                 DICOM object. Values will be returned in an array with length equal to the number
                 of occurances of the tag. If keyword is not specified, the method returns false in this case.
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000030-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000030-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 502</span>
502:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_bin</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">options</span>={})
503:       <span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">false</span>
504:       <span class="ruby-comment cmt"># Retrieve array position:</span>
505:       <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">element</span>)
506:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
507:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Invalid data element provided to method get_bin().&quot;</span>)
508:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
509:         <span class="ruby-comment cmt"># Multiple 'hits':</span>
510:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:array</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
511:           <span class="ruby-comment cmt"># Retrieve all values into an array:</span>
512:           <span class="ruby-identifier">value</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
513:           <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
514:             <span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@bin</span>[<span class="ruby-identifier">i</span>]
515:           <span class="ruby-keyword kw">end</span>
516:         <span class="ruby-keyword kw">else</span>
517:           <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Method get_bin() does not allow a query which yields multiple array hits. Please use array position instead of tag/name, or use keyword (:array =&gt; true).&quot;</span>)
518:         <span class="ruby-keyword kw">end</span>
519:       <span class="ruby-keyword kw">else</span>
520:         <span class="ruby-comment cmt"># One single match:</span>
521:         <span class="ruby-identifier">value</span> = <span class="ruby-ivar">@bin</span>[<span class="ruby-identifier">pos</span>[<span class="ruby-value">0</span>]]
522:         <span class="ruby-comment cmt"># Return the single value in an array if keyword :array used:</span>
523:         <span class="ruby-identifier">value</span> = [<span class="ruby-identifier">value</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:array</span>]
524:       <span class="ruby-keyword kw">end</span>
525:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>
526:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">get_frames</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the number of frames present in the image data in the <a
href="../DICOM.html">DICOM</a> file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 281</span>
281:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_frames</span>
282:       <span class="ruby-identifier">frames</span> = <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0008&quot;</span>, <span class="ruby-identifier">:silent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
283:       <span class="ruby-comment cmt"># If the DICOM object does not specify the number of frames explicitly, assume 1 image frame:</span>
284:       <span class="ruby-identifier">frames</span> = <span class="ruby-value">1</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">frames</span>
285:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">frames</span>.<span class="ruby-identifier">to_i</span>
286:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">get_image</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the image pixel data in a standard Ruby array. Returns false if it
fails to retrieve image data. The array does not carry the dimensions of
the pixel data, it will be a one dimensional array (vector). :rescale =&gt;
true - Return processed, rescaled presentation values instead of the
original, full pixel range.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 150</span>
150:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_image</span>(<span class="ruby-identifier">options</span>={})
151:       <span class="ruby-identifier">pixel_data</span> = <span class="ruby-keyword kw">false</span>
152:       <span class="ruby-identifier">pixel_element_pos</span> = <span class="ruby-identifier">get_image_pos</span>
153:       <span class="ruby-comment cmt"># A hack for the special case (some MR files), where two images are stored (one is a smaller thumbnail image):</span>
154:       <span class="ruby-identifier">pixel_element_pos</span> = [<span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">last</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0011&quot;</span>, <span class="ruby-identifier">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
155:       <span class="ruby-comment cmt"># For now we only support returning pixel data if the image is located in a single pixel data element:</span>
156:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
157:         <span class="ruby-comment cmt"># All of the pixel data is located in one element:</span>
158:         <span class="ruby-identifier">pixel_data</span> = <span class="ruby-identifier">get_pixels</span>(<span class="ruby-identifier">pixel_element_pos</span>[<span class="ruby-value">0</span>])
159:       <span class="ruby-keyword kw">else</span>
160:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Method get_image() does not currently support returning pixel data from encapsulated images!&quot;</span>)
161:       <span class="ruby-keyword kw">end</span>
162:       <span class="ruby-comment cmt"># Remap the image from pixel values to presentation values if the user has requested this:</span>
163:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rescale</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">pixel_data</span>
164:         <span class="ruby-comment cmt"># Process pixel data for presentation according to the image information in the DICOM object:</span>
165:         <span class="ruby-identifier">center</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">intercept</span>, <span class="ruby-identifier">slope</span> = <span class="ruby-identifier">window_level_values</span>
166:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:narray</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
167:           <span class="ruby-comment cmt"># Use numerical array (faster):</span>
168:           <span class="ruby-identifier">pixel_data</span> = <span class="ruby-identifier">process_presentation_values_narray</span>(<span class="ruby-identifier">pixel_data</span>, <span class="ruby-identifier">center</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">slope</span>, <span class="ruby-identifier">intercept</span>, <span class="ruby-value">-65535</span>, <span class="ruby-value">65535</span>).<span class="ruby-identifier">to_a</span>
169:         <span class="ruby-keyword kw">else</span>
170:           <span class="ruby-comment cmt"># Use standard Ruby array (slower):</span>
171:           <span class="ruby-identifier">pixel_data</span> = <span class="ruby-identifier">process_presentation_values</span>(<span class="ruby-identifier">pixel_data</span>, <span class="ruby-identifier">center</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">slope</span>, <span class="ruby-identifier">intercept</span>, <span class="ruby-value">-65535</span>, <span class="ruby-value">65535</span>)
172:         <span class="ruby-keyword kw">end</span>
173:       <span class="ruby-keyword kw">end</span>
174:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pixel_data</span>
175:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">get_image_magick</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of RMagick image objects, where the size of the array
corresponds to the number of frames in the image data. Returns false if it
fails to retrieve image data. To call this method the user needs to have
loaded the ImageMagick library in advance (require &#8216;RMagick&#8217;).
Options: :rescale =&gt; true - Return processed, rescaled presentation
values instead of the original, full pixel range. :narray =&gt; true - Use
NArray when rescaling pixel values (faster than using RMagick/Ruby array).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 242</span>
242:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_image_magick</span>(<span class="ruby-identifier">options</span>={})
243:       <span class="ruby-comment cmt"># Are we able to make an image?</span>
244:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@compression</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
245:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Notice: It seems pixel data is not present in this DICOM object.&quot;</span>)
246:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
247:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@color</span>
248:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Unpacking color pixel data is not supported yet for this method.&quot;</span>)
249:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
250:       <span class="ruby-keyword kw">end</span>
251:       <span class="ruby-comment cmt"># Gather information about the dimensions of the image data:</span>
252:       <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0010&quot;</span>, <span class="ruby-identifier">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)[<span class="ruby-value">0</span>]
253:       <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0011&quot;</span>, <span class="ruby-identifier">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)[<span class="ruby-value">0</span>]
254:       <span class="ruby-identifier">frames</span> = <span class="ruby-identifier">get_frames</span>
255:       <span class="ruby-identifier">pixel_element_pos</span> = <span class="ruby-identifier">get_image_pos</span>
256:       <span class="ruby-comment cmt"># Array that will hold the RMagick image objects, one object for each frame:</span>
257:       <span class="ruby-identifier">images</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">frames</span>)
258:       <span class="ruby-comment cmt"># A hack for the special case (some MR files), where two images are stored (one is a smaller thumbnail image):</span>
259:       <span class="ruby-identifier">pixel_element_pos</span> = [<span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">last</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0011&quot;</span>, <span class="ruby-identifier">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
260:       <span class="ruby-comment cmt"># Handling of pixel data will depend on whether we have one or more frames,</span>
261:       <span class="ruby-comment cmt"># and if it is located in one or more data elements:</span>
262:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
263:         <span class="ruby-comment cmt"># All of the pixel data is located in one data element:</span>
264:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frames</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
265:           <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Unfortunately, this method only supports reading the first image frame for 3D pixel data as of now.&quot;</span>)
266:         <span class="ruby-keyword kw">end</span>
267:         <span class="ruby-identifier">images</span> = <span class="ruby-identifier">read_image_magick</span>(<span class="ruby-identifier">pixel_element_pos</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">rows</span>, <span class="ruby-identifier">frames</span>, <span class="ruby-identifier">options</span>)
268:         <span class="ruby-identifier">images</span> = [<span class="ruby-identifier">images</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">images</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
269:       <span class="ruby-keyword kw">else</span>
270:         <span class="ruby-comment cmt"># Image data is encapsulated in items:</span>
271:         <span class="ruby-identifier">frames</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
272:           <span class="ruby-identifier">image</span> = <span class="ruby-identifier">read_image_magick</span>(<span class="ruby-identifier">pixel_element_pos</span>[<span class="ruby-identifier">i</span>], <span class="ruby-identifier">columns</span>, <span class="ruby-identifier">rows</span>, <span class="ruby-value">1</span>, <span class="ruby-identifier">options</span>)
273:           <span class="ruby-identifier">images</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">image</span>
274:         <span class="ruby-keyword kw">end</span>
275:       <span class="ruby-keyword kw">end</span>
276:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">images</span>
277:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">get_image_narray</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a 3d NArray object where the array dimensions corresponds to
[frames, columns, rows]. Returns false if it fails to retrieve image data.
To call this method the user needs to loaded the NArray library in advance
(require &#8216;narray&#8217;). Options: :rescale =&gt; true - Return
processed, rescaled presentation values instead of the original, full pixel
range.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 183</span>
183:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_image_narray</span>(<span class="ruby-identifier">options</span>={})
184:       <span class="ruby-comment cmt"># Are we able to make a pixel array?</span>
185:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@compression</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
186:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;It seems pixel data is not present in this DICOM object.&quot;</span>)
187:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
188:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@compression</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
189:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Reading compressed data to a NArray object not supported yet.&quot;</span>)
190:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
191:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@color</span>
192:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Unpacking color pixel data is not supported yet for this method.&quot;</span>)
193:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
194:       <span class="ruby-keyword kw">end</span>
195:       <span class="ruby-comment cmt"># Gather information about the dimensions of the pixel data:</span>
196:       <span class="ruby-identifier">rows</span> = <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0010&quot;</span>, <span class="ruby-identifier">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)[<span class="ruby-value">0</span>]
197:       <span class="ruby-identifier">columns</span> = <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0011&quot;</span>, <span class="ruby-identifier">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)[<span class="ruby-value">0</span>]
198:       <span class="ruby-identifier">frames</span> = <span class="ruby-identifier">get_frames</span>
199:       <span class="ruby-identifier">pixel_element_pos</span> = <span class="ruby-identifier">get_image_pos</span>
200:       <span class="ruby-comment cmt"># A hack for the special case (some MR files), where two images are stored (one is a smaller thumbnail image):</span>
201:       <span class="ruby-identifier">pixel_element_pos</span> = [<span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">last</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0011&quot;</span>, <span class="ruby-identifier">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
202:       <span class="ruby-comment cmt"># Creating a NArray object using int to make sure we have the necessary range for our numbers:</span>
203:       <span class="ruby-identifier">pixel_data</span> = <span class="ruby-constant">NArray</span>.<span class="ruby-identifier">int</span>(<span class="ruby-identifier">frames</span>,<span class="ruby-identifier">columns</span>,<span class="ruby-identifier">rows</span>)
204:       <span class="ruby-identifier">pixel_frame</span> = <span class="ruby-constant">NArray</span>.<span class="ruby-identifier">int</span>(<span class="ruby-identifier">columns</span>,<span class="ruby-identifier">rows</span>)
205:       <span class="ruby-comment cmt"># Handling of pixel data will depend on whether we have one or more frames,</span>
206:       <span class="ruby-comment cmt"># and if it is located in one or more data elements:</span>
207:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pixel_element_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
208:         <span class="ruby-comment cmt"># All of the pixel data is located in one element:</span>
209:         <span class="ruby-identifier">pixel_array</span> = <span class="ruby-identifier">get_pixels</span>(<span class="ruby-identifier">pixel_element_pos</span>[<span class="ruby-value">0</span>])
210:         <span class="ruby-identifier">frames</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
211:           (<span class="ruby-identifier">columns</span><span class="ruby-operator">*</span><span class="ruby-identifier">rows</span>).<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">j</span><span class="ruby-operator">|</span>
212:             <span class="ruby-identifier">pixel_frame</span>[<span class="ruby-identifier">j</span>] = <span class="ruby-identifier">pixel_array</span>[<span class="ruby-identifier">j</span><span class="ruby-operator">+</span><span class="ruby-identifier">i</span><span class="ruby-operator">*</span><span class="ruby-identifier">columns</span><span class="ruby-operator">*</span><span class="ruby-identifier">rows</span>]
213:           <span class="ruby-keyword kw">end</span>
214:           <span class="ruby-identifier">pixel_data</span>[<span class="ruby-identifier">i</span>,<span class="ruby-keyword kw">true</span>,<span class="ruby-keyword kw">true</span>] = <span class="ruby-identifier">pixel_frame</span>
215:         <span class="ruby-keyword kw">end</span>
216:       <span class="ruby-keyword kw">else</span>
217:         <span class="ruby-comment cmt"># Pixel data is encapsulated in items:</span>
218:         <span class="ruby-identifier">frames</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
219:           <span class="ruby-identifier">pixel_array</span> = <span class="ruby-identifier">get_pixels</span>(<span class="ruby-identifier">pixel_element_pos</span>[<span class="ruby-identifier">i</span>])
220:           (<span class="ruby-identifier">columns</span><span class="ruby-operator">*</span><span class="ruby-identifier">rows</span>).<span class="ruby-identifier">times</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">j</span><span class="ruby-operator">|</span>
221:             <span class="ruby-identifier">pixel_frame</span>[<span class="ruby-identifier">j</span>] = <span class="ruby-identifier">pixel_array</span>[<span class="ruby-identifier">j</span><span class="ruby-operator">+</span><span class="ruby-identifier">i</span><span class="ruby-operator">*</span><span class="ruby-identifier">columns</span><span class="ruby-operator">*</span><span class="ruby-identifier">rows</span>]
222:           <span class="ruby-keyword kw">end</span>
223:           <span class="ruby-identifier">pixel_data</span>[<span class="ruby-identifier">i</span>,<span class="ruby-keyword kw">true</span>,<span class="ruby-keyword kw">true</span>] = <span class="ruby-identifier">pixel_frame</span>
224:         <span class="ruby-keyword kw">end</span>
225:       <span class="ruby-keyword kw">end</span>
226:       <span class="ruby-comment cmt"># Remap the image from pixel values to presentation values if the user has requested this:</span>
227:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rescale</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
228:         <span class="ruby-comment cmt"># Process pixel data for presentation according to the image information in the DICOM object:</span>
229:         <span class="ruby-identifier">center</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">intercept</span>, <span class="ruby-identifier">slope</span> = <span class="ruby-identifier">window_level_values</span>
230:         <span class="ruby-identifier">pixel_data</span> = <span class="ruby-identifier">process_presentation_values_narray</span>(<span class="ruby-identifier">pixel_data</span>, <span class="ruby-identifier">center</span>, <span class="ruby-identifier">width</span>, <span class="ruby-identifier">slope</span>, <span class="ruby-identifier">intercept</span>, <span class="ruby-value">-65535</span>, <span class="ruby-value">65535</span>)
231:       <span class="ruby-keyword kw">end</span>
232:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pixel_data</span>
233:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000025" class="method-detail">
        <a name="M000025"></a>

        <div class="method-heading">
          <a href="#M000025" class="method-signature">
          <span class="method-name">get_image_pos</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the index(es) of the element(s) that contain image data.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000025-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000025-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 290</span>
290:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_image_pos</span>
291:       <span class="ruby-identifier">image_element_pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-value str">&quot;7FE0,0010&quot;</span>)
292:       <span class="ruby-identifier">item_pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-value str">&quot;FFFE,E000&quot;</span>)
293:       <span class="ruby-comment cmt"># Proceed only if an image element actually exists:</span>
294:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">image_element_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
295:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">false</span>
296:       <span class="ruby-keyword kw">else</span>
297:         <span class="ruby-comment cmt"># Check if we have item elements:</span>
298:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">item_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
299:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">image_element_pos</span>
300:         <span class="ruby-keyword kw">else</span>
301:           <span class="ruby-comment cmt"># Extract item positions that occur after the image element position:</span>
302:           <span class="ruby-identifier">late_item_pos</span> = <span class="ruby-identifier">item_pos</span>.<span class="ruby-identifier">select</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">image_element_pos</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">item</span>}
303:           <span class="ruby-comment cmt"># Check if there are items appearing after the image element.</span>
304:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">late_item_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
305:             <span class="ruby-comment cmt"># None occured after the image element position:</span>
306:             <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">image_element_pos</span>
307:           <span class="ruby-keyword kw">else</span>
308:             <span class="ruby-comment cmt"># Determine which of these late item elements contain image data.</span>
309:             <span class="ruby-comment cmt"># Usually, there are frames+1 late items, and all except</span>
310:             <span class="ruby-comment cmt"># the first item contain an image frame:</span>
311:             <span class="ruby-identifier">frames</span> = <span class="ruby-identifier">get_frames</span>
312:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">frames</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>  <span class="ruby-comment cmt"># note: function get_frames will never return false</span>
313:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">late_item_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">frames</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
314:                 <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">late_item_pos</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-identifier">late_item_pos</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>]
315:               <span class="ruby-keyword kw">else</span>
316:                 <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Unexpected behaviour in DICOM file for method get_image_pos. Expected number of image data items not equal to number of frames+1.&quot;</span>)
317:                 <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
318:               <span class="ruby-keyword kw">end</span>
319:             <span class="ruby-keyword kw">else</span>
320:               <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: 'Number of Frames' data element not found.&quot;</span>)
321:               <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
322:             <span class="ruby-keyword kw">end</span>
323:           <span class="ruby-keyword kw">end</span>
324:         <span class="ruby-keyword kw">end</span>
325:       <span class="ruby-keyword kw">end</span>
326:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000026" class="method-detail">
        <a name="M000026"></a>

        <div class="method-heading">
          <a href="#M000026" class="method-signature">
          <span class="method-name">get_pos</span><span class="method-args">(query, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of the index(es) of the element(s) in the <a
href="../DICOM.html">DICOM</a> file that match the supplied element
position, tag or name. If no match is found, the method will return false.
Additional options: :selection =&gt; mySelection - tells the method to
search for matches in this specific array of positions instead of searching
</p>
<pre>
                                 through the entire DICOM object. If mySelection is empty, the returned array will also be empty.
</pre>
<p>
:partial =&gt; true - <a href="DObject.html#M000026">get_pos</a> will not
only search for exact matches, but will search the names and tags arrays
for strings that contain the given search string. :parent =&gt; element -
This method will return only matches that are <a
href="DObject.html#M000028">children</a> of the specified (parent) data
element.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000026-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000026-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 336</span>
336:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">query</span>, <span class="ruby-identifier">options</span>={})
337:       <span class="ruby-identifier">search_array</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
338:       <span class="ruby-identifier">indexes</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
339:       <span class="ruby-comment cmt"># For convenience, allow query to be a one-element array (its value will be extracted):</span>
340:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
341:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">query</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
342:           <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Invalid array length supplied to method get_pos().&quot;</span>)
343:           <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
344:         <span class="ruby-keyword kw">else</span>
345:           <span class="ruby-identifier">query</span> = <span class="ruby-identifier">query</span>[<span class="ruby-value">0</span>]
346:         <span class="ruby-keyword kw">end</span>
347:       <span class="ruby-keyword kw">end</span>
348:       <span class="ruby-comment cmt"># Check if query is a number (some methods want to have the ability to call get_pos with a number):</span>
349:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
350:         <span class="ruby-comment cmt"># Return the position if it is valid:</span>
351:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">query</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@names</span>.<span class="ruby-identifier">length</span>
352:           <span class="ruby-identifier">indexes</span> = [<span class="ruby-identifier">query</span>]
353:         <span class="ruby-keyword kw">else</span>
354:           <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Error: The specified array position (#{query}) is out of range (valid: 0-#{@tags.length}).&quot;</span>)
355:         <span class="ruby-keyword kw">end</span>
356:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">query</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
357:         <span class="ruby-comment cmt"># Has the user specified an array to search within?</span>
358:         <span class="ruby-identifier">search_array</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selection</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selection</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
359:         <span class="ruby-comment cmt"># Has the user specified a specific parent which will restrict our search to only it's children?</span>
360:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:parent</span>]
361:           <span class="ruby-identifier">parent_pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:parent</span>], <span class="ruby-identifier">:next_only</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:next_only</span>])
362:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parent_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
363:             <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Error: Invalid parent supplied to method get_pos().&quot;</span>)
364:             <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
365:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">parent_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
366:             <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Error: The parent you supplied to method get_pos() gives multiple hits. A more precise parent specification is needed.&quot;</span>)
367:             <span class="ruby-keyword kw">return</span> <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
368:           <span class="ruby-keyword kw">end</span>
369:           <span class="ruby-comment cmt"># Find the children of this particular tag:</span>
370:           <span class="ruby-identifier">children_pos</span> = <span class="ruby-identifier">children</span>(<span class="ruby-identifier">parent_pos</span>)
371:           <span class="ruby-comment cmt"># If selection has also been specified along with parent, we need to extract the array positions that are common to the two arrays:</span>
372:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">search_array</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
373:             <span class="ruby-identifier">search_array</span> = <span class="ruby-identifier">search_array</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">children_pos</span>
374:           <span class="ruby-keyword kw">else</span>
375:             <span class="ruby-identifier">search_array</span> = <span class="ruby-identifier">children_pos</span>
376:           <span class="ruby-keyword kw">end</span>
377:         <span class="ruby-keyword kw">end</span>
378:         <span class="ruby-comment cmt"># Search the entire DICOM object if no restrictions have been set:</span>
379:         <span class="ruby-identifier">search_array</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@names</span>.<span class="ruby-identifier">length</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>} <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:selection</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:parent</span>]
380:         <span class="ruby-comment cmt"># Perform search:</span>
381:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:partial</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
382:           <span class="ruby-comment cmt"># Search for partial string matches:</span>
383:           <span class="ruby-identifier">partial_indexes</span> = <span class="ruby-identifier">search_array</span>.<span class="ruby-identifier">all_indices_partial_match</span>(<span class="ruby-ivar">@tags</span>, <span class="ruby-identifier">query</span>.<span class="ruby-identifier">upcase</span>)
384:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">partial_indexes</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
385:             <span class="ruby-identifier">indexes</span> = <span class="ruby-identifier">partial_indexes</span>
386:           <span class="ruby-keyword kw">else</span>
387:             <span class="ruby-identifier">indexes</span> = <span class="ruby-identifier">search_array</span>.<span class="ruby-identifier">all_indices_partial_match</span>(<span class="ruby-ivar">@names</span>, <span class="ruby-identifier">query</span>)
388:           <span class="ruby-keyword kw">end</span>
389:         <span class="ruby-keyword kw">else</span>
390:           <span class="ruby-comment cmt"># Search for identical matches:</span>
391:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">query</span>[<span class="ruby-value">4</span><span class="ruby-operator">..</span><span class="ruby-value">4</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;,&quot;</span>
392:             <span class="ruby-identifier">indexes</span> = <span class="ruby-identifier">search_array</span>.<span class="ruby-identifier">all_indices</span>(<span class="ruby-ivar">@tags</span>, <span class="ruby-identifier">query</span>.<span class="ruby-identifier">upcase</span>)
393:           <span class="ruby-keyword kw">else</span>
394:             <span class="ruby-identifier">indexes</span> = <span class="ruby-identifier">search_array</span>.<span class="ruby-identifier">all_indices</span>(<span class="ruby-ivar">@names</span>, <span class="ruby-identifier">query</span>)
395:           <span class="ruby-keyword kw">end</span>
396:         <span class="ruby-keyword kw">end</span>
397:       <span class="ruby-keyword kw">end</span>
398:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">indexes</span>
399:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000029" class="method-detail">
        <a name="M000029"></a>

        <div class="method-heading">
          <a href="#M000029" class="method-signature">
          <span class="method-name">get_value</span><span class="method-args">(element, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the value (processed binary data) of the requested <a
href="../DICOM.html">DICOM</a> data element. Data element may be specified
by array position, tag or name. Options: :array =&gt; true - Allows the
query of the value of a tag that occurs more than one time in the
</p>
<pre>
                 DICOM object. Values will be returned in an array with length equal to the number
                 of occurances of the tag. If keyword is not specified, the method returns false in this case.
</pre>
<p>
:silent =&gt; true - As this method is also used internally, we want the
possibility of warnings not being
</p>
<pre>
                 raised even if verbose is set to true by the user, in order to avoid unnecessary confusion.
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000029-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000029-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 469</span>
469:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_value</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">options</span>={})
470:       <span class="ruby-identifier">value</span> = <span class="ruby-keyword kw">false</span>
471:       <span class="ruby-comment cmt"># Retrieve array position:</span>
472:       <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">element</span>)
473:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
474:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Warning: Invalid data element provided to method get_value() (#{element}).&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:silent</span>]
475:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
476:         <span class="ruby-comment cmt"># Multiple 'hits':</span>
477:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:array</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
478:           <span class="ruby-comment cmt"># Retrieve all values into an array:</span>
479:           <span class="ruby-identifier">value</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
480:           <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
481:             <span class="ruby-identifier">value</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@values</span>[<span class="ruby-identifier">i</span>]
482:           <span class="ruby-keyword kw">end</span>
483:         <span class="ruby-keyword kw">else</span>
484:           <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Warning: Method get_value() does not allow a query which yields multiple array hits (#{element}). Please use array position instead of tag/name, or use option (:array =&gt; true) to return all values.&quot;</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:silent</span>]
485:         <span class="ruby-keyword kw">end</span>
486:       <span class="ruby-keyword kw">else</span>
487:         <span class="ruby-comment cmt"># One single match:</span>
488:         <span class="ruby-identifier">value</span> = <span class="ruby-ivar">@values</span>[<span class="ruby-identifier">pos</span>[<span class="ruby-value">0</span>]]
489:         <span class="ruby-comment cmt"># Return the single value in an array if keyword :array used:</span>
490:         <span class="ruby-identifier">value</span> = [<span class="ruby-identifier">value</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:array</span>]
491:       <span class="ruby-keyword kw">end</span>
492:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">value</span>
493:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000027" class="method-detail">
        <a name="M000027"></a>

        <div class="method-heading">
          <a href="#M000027" class="method-signature">
          <span class="method-name">image_to_file</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Dumps the binary content of the Pixel Data element to file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000027-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000027-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 403</span>
403:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">image_to_file</span>(<span class="ruby-identifier">file</span>)
404:       <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">get_image_pos</span>
405:       <span class="ruby-comment cmt"># Pixel data may be located in several elements:</span>
406:       <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
407:         <span class="ruby-identifier">pixel_data</span> = <span class="ruby-identifier">get_bin</span>(<span class="ruby-identifier">pos</span>[<span class="ruby-identifier">i</span>])
408:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
409:           <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">&quot;wb&quot;</span>)
410:         <span class="ruby-keyword kw">else</span>
411:           <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-value str">&quot;wb&quot;</span>)
412:         <span class="ruby-keyword kw">end</span>
413:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">pixel_data</span>)
414:         <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
415:       <span class="ruby-keyword kw">end</span>
416:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000031" class="method-detail">
        <a name="M000031"></a>

        <div class="method-heading">
          <a href="#M000031" class="method-signature">
          <span class="method-name">parents</span><span class="method-args">(element)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the position of (possible) <a
href="DObject.html#M000031">parents</a> of the specified data element in
the hierarchy structure of the <a href="../DICOM.html">DICOM</a> object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000031-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000031-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 530</span>
530:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parents</span>(<span class="ruby-identifier">element</span>)
531:       <span class="ruby-identifier">parent_pos</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
532:       <span class="ruby-comment cmt"># Retrieve array position:</span>
533:       <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">element</span>)
534:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
535:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Invalid data element provided to method parents().&quot;</span>)
536:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
537:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Warning: Method parents() does not allow a query which yields multiple array hits. Please use array position instead of tag/name.&quot;</span>)
538:       <span class="ruby-keyword kw">else</span>
539:         <span class="ruby-comment cmt"># Proceed to find the value:</span>
540:         <span class="ruby-comment cmt"># Get the level of our element:</span>
541:         <span class="ruby-identifier">level</span> = <span class="ruby-ivar">@levels</span>[<span class="ruby-identifier">pos</span>[<span class="ruby-value">0</span>]]
542:         <span class="ruby-comment cmt"># Element can obviously only have parents if it is not a top level element:</span>
543:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">level</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
544:           <span class="ruby-comment cmt"># Search backwards, and record the position every time we encounter an upwards change in the level number.</span>
545:           <span class="ruby-identifier">prev_level</span> = <span class="ruby-identifier">level</span>
546:           <span class="ruby-identifier">search_arr</span> = <span class="ruby-ivar">@levels</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">pos</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">-</span><span class="ruby-value">1</span>].<span class="ruby-identifier">reverse</span>
547:           <span class="ruby-identifier">search_arr</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
548:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">search_arr</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">prev_level</span>
549:               <span class="ruby-identifier">parent_pos</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">search_arr</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-identifier">i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>
550:               <span class="ruby-identifier">prev_level</span> = <span class="ruby-identifier">search_arr</span>[<span class="ruby-identifier">i</span>]
551:             <span class="ruby-keyword kw">end</span>
552:           <span class="ruby-keyword kw">end</span>
553:           <span class="ruby-comment cmt"># When the element has several generations of parents, we want its top parent to be first in the returned array:</span>
554:           <span class="ruby-identifier">parent_pos</span> = <span class="ruby-identifier">parent_pos</span>.<span class="ruby-identifier">reverse</span>
555:         <span class="ruby-keyword kw">end</span>
556:       <span class="ruby-keyword kw">end</span>
557:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">parent_pos</span>
558:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000033" class="method-detail">
        <a name="M000033"></a>

        <div class="method-heading">
          <a href="#M000033" class="method-signature">
          <span class="method-name">print</span><span class="method-args">(pos, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Prints the information of the specified elements: Index, [hierarchy level,
tree visualisation,] tag, name, vr, length, value The supplied variable may
be a single position, an array of positions, or true - which will make the
method <a href="DObject.html#M000033">print</a> all elements. Optional
arguments: :levels =&gt; true - method will <a
href="DObject.html#M000033">print</a> the level numbers for each element.
:tree =&gt; true - method will <a href="DObject.html#M000033">print</a> a
tree structure for the elements. :file =&gt; true - method will <a
href="DObject.html#M000033">print</a> to file instead of printing to
screen.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000033-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000033-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 580</span>
580:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">print</span>(<span class="ruby-identifier">pos</span>, <span class="ruby-identifier">options</span>={})
581:       <span class="ruby-comment cmt"># Process option values, setting defaults for the ones that are not specified:</span>
582:       <span class="ruby-identifier">opt_levels</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:levels</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>
583:       <span class="ruby-identifier">opt_tree</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:tree</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>
584:       <span class="ruby-identifier">opt_file</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:file</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword kw">false</span>
585:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
586:         <span class="ruby-comment cmt"># Create a complete array of indices:</span>
587:         <span class="ruby-identifier">pos_valid</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@names</span>.<span class="ruby-identifier">length</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>}
588:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
589:         <span class="ruby-comment cmt"># Convert number to array:</span>
590:         <span class="ruby-identifier">pos_valid</span> = [<span class="ruby-identifier">pos</span>]
591:       <span class="ruby-keyword kw">else</span>
592:         <span class="ruby-comment cmt"># Use the supplied array of numbers:</span>
593:         <span class="ruby-identifier">pos_valid</span> = <span class="ruby-identifier">pos</span>
594:       <span class="ruby-keyword kw">end</span>
595:       <span class="ruby-comment cmt"># Extract the information to be printed from the object arrays:</span>
596:       <span class="ruby-identifier">indices</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
597:       <span class="ruby-identifier">levels</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
598:       <span class="ruby-identifier">tags</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
599:       <span class="ruby-identifier">names</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
600:       <span class="ruby-identifier">types</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
601:       <span class="ruby-identifier">lengths</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
602:       <span class="ruby-identifier">values</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
603:       <span class="ruby-comment cmt"># There may be a more elegant way to do this.</span>
604:       <span class="ruby-identifier">pos_valid</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pos</span><span class="ruby-operator">|</span>
605:         <span class="ruby-identifier">tags</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@tags</span>[<span class="ruby-identifier">pos</span>]
606:         <span class="ruby-identifier">levels</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@levels</span>[<span class="ruby-identifier">pos</span>].<span class="ruby-identifier">to_s</span>
607:         <span class="ruby-identifier">names</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@names</span>[<span class="ruby-identifier">pos</span>]
608:         <span class="ruby-identifier">types</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@vr</span>[<span class="ruby-identifier">pos</span>]
609:         <span class="ruby-identifier">lengths</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@lengths</span>[<span class="ruby-identifier">pos</span>].<span class="ruby-identifier">to_s</span>
610:         <span class="ruby-identifier">values</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@values</span>[<span class="ruby-identifier">pos</span>].<span class="ruby-identifier">to_s</span>
611:       <span class="ruby-keyword kw">end</span>
612:       <span class="ruby-comment cmt"># We have collected the data that is to be printed, now we need to do some string manipulation if hierarchy is to be displayed:</span>
613:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opt_tree</span>
614:         <span class="ruby-comment cmt"># Tree structure requested.</span>
615:         <span class="ruby-identifier">front_symbol</span> = <span class="ruby-value str">&quot;| &quot;</span>
616:         <span class="ruby-identifier">tree_symbol</span> = <span class="ruby-value str">&quot;|_&quot;</span>
617:         <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
618:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">levels</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;0&quot;</span>
619:             <span class="ruby-identifier">tags</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">front_symbol</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">levels</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">to_i</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">tree_symbol</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tags</span>[<span class="ruby-identifier">i</span>]
620:           <span class="ruby-keyword kw">end</span>
621:         <span class="ruby-keyword kw">end</span>
622:       <span class="ruby-keyword kw">end</span>
623:       <span class="ruby-comment cmt"># Extract the string lengths which are needed to make the formatting nice:</span>
624:       <span class="ruby-identifier">tag_lengths</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
625:       <span class="ruby-identifier">lev_lengths</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
626:       <span class="ruby-identifier">name_lengths</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
627:       <span class="ruby-identifier">type_lengths</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
628:       <span class="ruby-identifier">length_lengths</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
629:       <span class="ruby-identifier">names</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
630:         <span class="ruby-identifier">tag_lengths</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">tags</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span>
631:         <span class="ruby-identifier">lev_lengths</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">levels</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span>
632:         <span class="ruby-identifier">name_lengths</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">names</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span>
633:         <span class="ruby-identifier">type_lengths</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">types</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span>
634:         <span class="ruby-identifier">length_lengths</span>[<span class="ruby-identifier">i</span>] = <span class="ruby-identifier">lengths</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">length</span>
635:       <span class="ruby-keyword kw">end</span>
636:       <span class="ruby-comment cmt"># To give the printed output a nice format we need to check the string lengths of some of these arrays:</span>
637:       <span class="ruby-identifier">index_maxL</span> = <span class="ruby-identifier">pos_valid</span>.<span class="ruby-identifier">max</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">length</span>
638:       <span class="ruby-identifier">lev_maxL</span> = <span class="ruby-identifier">lev_lengths</span>.<span class="ruby-identifier">max</span>
639:       <span class="ruby-identifier">tag_maxL</span> = <span class="ruby-identifier">tag_lengths</span>.<span class="ruby-identifier">max</span>
640:       <span class="ruby-identifier">name_maxL</span> = <span class="ruby-identifier">name_lengths</span>.<span class="ruby-identifier">max</span>
641:       <span class="ruby-identifier">type_maxL</span> = <span class="ruby-identifier">type_lengths</span>.<span class="ruby-identifier">max</span>
642:       <span class="ruby-identifier">length_maxL</span> = <span class="ruby-identifier">length_lengths</span>.<span class="ruby-identifier">max</span>
643:       <span class="ruby-comment cmt"># Construct the strings, one for each line of output, where each line contain the information of one data element:</span>
644:       <span class="ruby-identifier">elements</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
645:       <span class="ruby-comment cmt"># Start of loop which formats the element data:</span>
646:       <span class="ruby-comment cmt"># (This loop is what consumes most of the computing time of this method)</span>
647:       <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">each_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
648:         <span class="ruby-comment cmt"># Configure empty spaces:</span>
649:         <span class="ruby-identifier">s</span> = <span class="ruby-value str">&quot; &quot;</span>
650:         <span class="ruby-identifier">f0</span> = <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">index_maxL</span><span class="ruby-operator">-</span><span class="ruby-identifier">pos_valid</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">length</span>)
651:         <span class="ruby-identifier">f1</span> = <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">lev_maxL</span><span class="ruby-operator">-</span><span class="ruby-identifier">levels</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span>)
652:         <span class="ruby-identifier">f2</span> = <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">tag_maxL</span><span class="ruby-operator">-</span><span class="ruby-identifier">tags</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)
653:         <span class="ruby-identifier">f3</span> = <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">name_maxL</span><span class="ruby-operator">-</span><span class="ruby-identifier">names</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)
654:         <span class="ruby-identifier">f4</span> = <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">type_maxL</span><span class="ruby-operator">-</span><span class="ruby-identifier">types</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>)
655:         <span class="ruby-identifier">f5</span> = <span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">*</span>(<span class="ruby-identifier">length_maxL</span><span class="ruby-operator">-</span><span class="ruby-identifier">lengths</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span>)
656:         <span class="ruby-comment cmt"># Display levels?</span>
657:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opt_levels</span>
658:           <span class="ruby-identifier">lev</span> = <span class="ruby-identifier">levels</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">f1</span>
659:         <span class="ruby-keyword kw">else</span>
660:           <span class="ruby-identifier">lev</span> = <span class="ruby-value str">&quot;&quot;</span>
661:         <span class="ruby-keyword kw">end</span>
662:         <span class="ruby-comment cmt"># Restrict length of value string:</span>
663:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">values</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">28</span>
664:           <span class="ruby-identifier">value</span> = (<span class="ruby-identifier">values</span>[<span class="ruby-identifier">i</span>])[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">27</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot; ...&quot;</span>
665:         <span class="ruby-keyword kw">else</span>
666:           <span class="ruby-identifier">value</span> = (<span class="ruby-identifier">values</span>[<span class="ruby-identifier">i</span>])
667:         <span class="ruby-keyword kw">end</span>
668:         <span class="ruby-comment cmt"># Insert descriptive text for elements that hold binary data:</span>
669:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">types</span>[<span class="ruby-identifier">i</span>]
670:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;OW&quot;</span>,<span class="ruby-value str">&quot;OB&quot;</span>,<span class="ruby-value str">&quot;UN&quot;</span>
671:             <span class="ruby-identifier">value</span> = <span class="ruby-value str">&quot;(Binary Data)&quot;</span>
672:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;SQ&quot;</span>
673:             <span class="ruby-identifier">value</span> = <span class="ruby-value str">&quot;(Encapsulated Elements)&quot;</span>
674:           <span class="ruby-keyword kw">when</span> <span class="ruby-value str">&quot;()&quot;</span>
675:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tags</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-value str">&quot;FFFE,E000&quot;</span>) <span class="ruby-comment cmt"># (Item)</span>
676:               <span class="ruby-identifier">value</span> = <span class="ruby-value str">&quot;(Encapsulated Elements)&quot;</span>
677:             <span class="ruby-keyword kw">else</span>
678:               <span class="ruby-identifier">value</span> = <span class="ruby-value str">&quot;&quot;</span>
679:             <span class="ruby-keyword kw">end</span>
680:         <span class="ruby-keyword kw">end</span>
681:         <span class="ruby-identifier">elements</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">f0</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pos_valid</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">lev</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tags</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">f2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">names</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">f3</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">types</span>[<span class="ruby-identifier">i</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">f4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">f5</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">lengths</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">rstrip</span>)
682:       <span class="ruby-keyword kw">end</span>
683:       <span class="ruby-comment cmt"># Print to either screen or file, depending on what the user requested:</span>
684:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">opt_file</span>
685:         <span class="ruby-identifier">print_file</span>(<span class="ruby-identifier">elements</span>)
686:       <span class="ruby-keyword kw">else</span>
687:         <span class="ruby-identifier">print_screen</span>(<span class="ruby-identifier">elements</span>)
688:       <span class="ruby-keyword kw">end</span>
689:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000032" class="method-detail">
        <a name="M000032"></a>

        <div class="method-heading">
          <a href="#M000032" class="method-signature">
          <span class="method-name">print_all</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Prints the information of all elements stored in the <a
href="../DICOM.html">DICOM</a> object. This method is kept for backwards
compatibility. Instead of calling <a
href="DObject.html#M000032">print_all</a> you may use <a
href="DObject.html#M000033">print</a>(true) for the same functionality.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000032-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000032-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 569</span>
569:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">print_all</span>
570:       <span class="ruby-identifier">print</span>(<span class="ruby-keyword kw">true</span>)
571:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000034" class="method-detail">
        <a name="M000034"></a>

        <div class="method-heading">
          <a href="#M000034" class="method-signature">
          <span class="method-name">print_properties</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Prints the key structural properties of the <a
href="../DICOM.html">DICOM</a> file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000034-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000034-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 693</span>
693:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">print_properties</span>
694:       <span class="ruby-comment cmt"># Explicitness:</span>
695:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@explicit</span>
696:         <span class="ruby-identifier">explicit</span> = <span class="ruby-value str">&quot;Explicit&quot;</span>
697:       <span class="ruby-keyword kw">else</span>
698:         <span class="ruby-identifier">explicit</span> = <span class="ruby-value str">&quot;Implicit&quot;</span>
699:       <span class="ruby-keyword kw">end</span>
700:       <span class="ruby-comment cmt"># Endianness:</span>
701:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@file_endian</span>
702:         <span class="ruby-identifier">endian</span> = <span class="ruby-value str">&quot;Big Endian&quot;</span>
703:       <span class="ruby-keyword kw">else</span>
704:         <span class="ruby-identifier">endian</span> = <span class="ruby-value str">&quot;Little Endian&quot;</span>
705:       <span class="ruby-keyword kw">end</span>
706:       <span class="ruby-comment cmt"># Pixel data:</span>
707:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@compression</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
708:         <span class="ruby-identifier">pixels</span> = <span class="ruby-value str">&quot;No&quot;</span>
709:       <span class="ruby-keyword kw">else</span>
710:         <span class="ruby-identifier">pixels</span> = <span class="ruby-value str">&quot;Yes&quot;</span>
711:       <span class="ruby-keyword kw">end</span>
712:       <span class="ruby-comment cmt"># Colors:</span>
713:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@color</span>
714:         <span class="ruby-identifier">image</span> = <span class="ruby-value str">&quot;Colors&quot;</span>
715:       <span class="ruby-keyword kw">else</span>
716:         <span class="ruby-identifier">image</span> = <span class="ruby-value str">&quot;Greyscale&quot;</span>
717:       <span class="ruby-keyword kw">end</span>
718:       <span class="ruby-comment cmt"># Compression:</span>
719:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@compression</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
720:         <span class="ruby-identifier">compression</span> = <span class="ruby-constant">LIBRARY</span>.<span class="ruby-identifier">get_uid</span>(<span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0002,0010&quot;</span>).<span class="ruby-identifier">rstrip</span>)
721:       <span class="ruby-keyword kw">else</span>
722:         <span class="ruby-identifier">compression</span> = <span class="ruby-value str">&quot;No&quot;</span>
723:       <span class="ruby-keyword kw">end</span>
724:       <span class="ruby-comment cmt"># Bits per pixel (allocated):</span>
725:       <span class="ruby-identifier">bits</span> = <span class="ruby-identifier">get_value</span>(<span class="ruby-value str">&quot;0028,0100&quot;</span>, <span class="ruby-identifier">:array</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:silent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
726:       <span class="ruby-identifier">bits</span> = <span class="ruby-identifier">bits</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bits</span>
727:       <span class="ruby-comment cmt"># Print the file properties:</span>
728:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Key properties of DICOM object:&quot;</span>
729:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;-------------------------------&quot;</span>
730:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;File:           &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@file</span>
731:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Modality:       &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@modality</span>.<span class="ruby-identifier">to_s</span>
732:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Value repr.:    &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">explicit</span>
733:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Byte order:     &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">endian</span>
734:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Pixel data:     &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pixels</span>
735:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pixels</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Yes&quot;</span>
736:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Image:          &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">image</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">image</span>
737:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Compression:    &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">compression</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">compression</span>
738:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Bits per pixel: &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">bits</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bits</span>
739:       <span class="ruby-keyword kw">end</span>
740:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;-------------------------------&quot;</span>
741:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">read</span><span class="method-args">(string, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a <a href="../DICOM.html">DICOM</a> object by reading the file
specified. This is accomplished by initliazing the <a
href="DRead.html">DRead</a> class, which loads <a
href="../DICOM.html">DICOM</a> information to arrays. For the time being,
this method is called automatically when initializing the <a
href="DObject.html">DObject</a> class, but in the future, when <a
href="DObject.html#M000019">write</a> support is added, this method may
have to be called manually.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 85</span>
 85:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read</span>(<span class="ruby-identifier">string</span>, <span class="ruby-identifier">options</span> = {})
 86:       <span class="ruby-identifier">r</span> = <span class="ruby-constant">DRead</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">string</span>, <span class="ruby-identifier">:sys_endian</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sys_endian</span>, <span class="ruby-identifier">:bin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:bin</span>], <span class="ruby-identifier">:syntax</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:syntax</span>])
 87:       <span class="ruby-comment cmt"># Store the data to the instance variables if the readout was a success:</span>
 88:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">success</span>
 89:         <span class="ruby-ivar">@read_success</span> = <span class="ruby-keyword kw">true</span>
 90:         <span class="ruby-ivar">@names</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">names</span>
 91:         <span class="ruby-ivar">@tags</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">tags</span>
 92:         <span class="ruby-ivar">@vr</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">vr</span>
 93:         <span class="ruby-ivar">@lengths</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">lengths</span>
 94:         <span class="ruby-ivar">@values</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">values</span>
 95:         <span class="ruby-ivar">@bin</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">bin</span>
 96:         <span class="ruby-ivar">@levels</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">levels</span>
 97:         <span class="ruby-ivar">@explicit</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">explicit</span>
 98:         <span class="ruby-ivar">@file_endian</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">file_endian</span>
 99:         <span class="ruby-comment cmt"># Update Stream instance with settings from this DICOM file:</span>
100:         <span class="ruby-ivar">@stream</span>.<span class="ruby-identifier">set_endian</span>(<span class="ruby-ivar">@file_endian</span>)
101:         <span class="ruby-ivar">@stream</span>.<span class="ruby-identifier">explicit</span> = <span class="ruby-ivar">@explicit</span>
102:         <span class="ruby-comment cmt"># Update status variables for this object:</span>
103:         <span class="ruby-identifier">check_properties</span>
104:         <span class="ruby-comment cmt"># Set the modality of the DICOM object:</span>
105:         <span class="ruby-identifier">set_modality</span>
106:       <span class="ruby-keyword kw">else</span>
107:         <span class="ruby-ivar">@read_success</span> = <span class="ruby-keyword kw">false</span>
108:       <span class="ruby-keyword kw">end</span>
109:       <span class="ruby-comment cmt"># Check if a partial extraction has been requested (used for network communication purposes)</span>
110:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:segment_size</span>]
111:         <span class="ruby-ivar">@segments</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">extract_segments</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:segment_size</span>])
112:       <span class="ruby-keyword kw">end</span>
113:       <span class="ruby-comment cmt"># If any messages has been recorded, send these to the message handling method:</span>
114:       <span class="ruby-identifier">add_msg</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">msg</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">msg</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
115:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000039" class="method-detail">
        <a name="M000039"></a>

        <div class="method-heading">
          <a href="#M000039" class="method-signature">
          <span class="method-name">remove</span><span class="method-args">(element, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Removes an element from the <a href="../DICOM.html">DICOM</a> object.
Options: :ignore_children =&gt; true - Force the method to ignore <a
href="DObject.html#M000028">children</a> when removing an element.
</p>
<pre>
   (default behaviour is to remove any children if a sequence or item is removed)
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000039-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000039-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 833</span>
833:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">options</span>={})
834:       <span class="ruby-identifier">positions</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">element</span>)
835:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">positions</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
836:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Warning: The given data element (#{element}) could not be found in the DICOM object. Method remove() has no data element to remove.&quot;</span>)
837:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">positions</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
838:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Warning: Method remove() does not allow an element query which yields multiple array hits (#{element}). Please use array position instead of tag/name. Value(s) NOT removed.&quot;</span>)
839:       <span class="ruby-keyword kw">else</span>
840:         <span class="ruby-comment cmt"># Check if the tag selected for removal has children (relevant for sequence/item tags):</span>
841:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:ignore_children</span>]
842:           <span class="ruby-identifier">child_pos</span> = <span class="ruby-identifier">children</span>(<span class="ruby-identifier">positions</span>)
843:           <span class="ruby-comment cmt"># Add the positions of the children (if they exist) to our original tag's position array:</span>
844:           <span class="ruby-identifier">positions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">child_pos</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">child_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
845:         <span class="ruby-keyword kw">end</span>
846:         <span class="ruby-identifier">positions</span>.<span class="ruby-identifier">flatten!</span>
847:         <span class="ruby-comment cmt"># Loop through all positions (important to do this in reverse to retain predictable array positions):</span>
848:         <span class="ruby-identifier">positions</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pos</span><span class="ruby-operator">|</span>
849:           <span class="ruby-comment cmt"># Update group length</span>
850:           <span class="ruby-comment cmt"># (Possible weakness: Group length tag contained inside a sequence/item. Code needs a slight rewrite to make it more robust)</span>
851:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tags</span>[<span class="ruby-identifier">pos</span>][<span class="ruby-value">5</span><span class="ruby-operator">..</span><span class="ruby-value">8</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;0000&quot;</span>
852:             <span class="ruby-comment cmt"># Note: When removing an item/sequence, its length value must not be used for 'change' (it's value is in reality nil):</span>
853:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@vr</span>[<span class="ruby-identifier">pos</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;()&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@vr</span>[<span class="ruby-identifier">pos</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;SQ&quot;</span>
854:               <span class="ruby-identifier">change</span> = <span class="ruby-value">0</span>
855:             <span class="ruby-keyword kw">else</span>
856:               <span class="ruby-identifier">change</span> = <span class="ruby-ivar">@lengths</span>[<span class="ruby-identifier">pos</span>]
857:             <span class="ruby-keyword kw">end</span>
858:             <span class="ruby-identifier">vr</span> = <span class="ruby-ivar">@vr</span>[<span class="ruby-identifier">pos</span>]
859:             <span class="ruby-identifier">update_group_and_parents_length</span>(<span class="ruby-identifier">pos</span>, <span class="ruby-identifier">vr</span>, <span class="ruby-identifier">change</span>, <span class="ruby-value">-1</span>)
860:           <span class="ruby-keyword kw">end</span>
861:           <span class="ruby-comment cmt"># Remove entry from arrays:</span>
862:           <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">pos</span>)
863:           <span class="ruby-ivar">@levels</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">pos</span>)
864:           <span class="ruby-ivar">@names</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">pos</span>)
865:           <span class="ruby-ivar">@vr</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">pos</span>)
866:           <span class="ruby-ivar">@lengths</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">pos</span>)
867:           <span class="ruby-ivar">@values</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">pos</span>)
868:           <span class="ruby-ivar">@bin</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">pos</span>)
869:         <span class="ruby-keyword kw">end</span>
870:       <span class="ruby-keyword kw">end</span>
871:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000040" class="method-detail">
        <a name="M000040"></a>

        <div class="method-heading">
          <a href="#M000040" class="method-signature">
          <span class="method-name">remove_private</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Removes all private data elements from the <a
href="../DICOM.html">DICOM</a> object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000040-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000040-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 875</span>
875:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_private</span>
876:       <span class="ruby-comment cmt"># Private data elemements have a group tag that is odd.</span>
877:       <span class="ruby-identifier">odd_group</span> = [<span class="ruby-value str">&quot;1,&quot;</span>,<span class="ruby-value str">&quot;3,&quot;</span>,<span class="ruby-value str">&quot;5,&quot;</span>,<span class="ruby-value str">&quot;7,&quot;</span>,<span class="ruby-value str">&quot;9,&quot;</span>,<span class="ruby-value str">&quot;B,&quot;</span>,<span class="ruby-value str">&quot;D,&quot;</span>,<span class="ruby-value str">&quot;F,&quot;</span>]
878:       <span class="ruby-identifier">odd_group</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">odd</span><span class="ruby-operator">|</span>
879:         <span class="ruby-identifier">positions</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">odd</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
880:         <span class="ruby-comment cmt"># Delete all entries (important to do this in reverse order).</span>
881:         <span class="ruby-identifier">positions</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pos</span><span class="ruby-operator">|</span>
882:           <span class="ruby-identifier">remove</span>(<span class="ruby-identifier">pos</span>)
883:         <span class="ruby-keyword kw">end</span>
884:       <span class="ruby-keyword kw">end</span>
885:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000035" class="method-detail">
        <a name="M000035"></a>

        <div class="method-heading">
          <a href="#M000035" class="method-signature">
          <span class="method-name">set_image</span><span class="method-args">(pixel_array)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes pixel data from a Ruby <a href="../Array.html">Array</a> object to
the pixel data element.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000035-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000035-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 750</span>
750:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_image</span>(<span class="ruby-identifier">pixel_array</span>)
751:       <span class="ruby-comment cmt"># Encode this array using the standard class method:</span>
752:       <span class="ruby-identifier">set_value</span>(<span class="ruby-identifier">pixel_array</span>, <span class="ruby-value str">&quot;7FE0,0010&quot;</span>, <span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
753:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000036" class="method-detail">
        <a name="M000036"></a>

        <div class="method-heading">
          <a href="#M000036" class="method-signature">
          <span class="method-name">set_image_file</span><span class="method-args">(file)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Reads binary information from file and inserts it in the pixel data
element.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000036-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000036-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 757</span>
757:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_image_file</span>(<span class="ruby-identifier">file</span>)
758:       <span class="ruby-comment cmt"># Try to read file:</span>
759:       <span class="ruby-keyword kw">begin</span>
760:         <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">&quot;rb&quot;</span>)
761:         <span class="ruby-identifier">bin</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">stat</span>.<span class="ruby-identifier">size</span>)
762:       <span class="ruby-keyword kw">rescue</span>
763:         <span class="ruby-comment cmt"># Reading file was not successful. Register an error message.</span>
764:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Reading specified file was not successful for some reason. No data has been added.&quot;</span>)
765:         <span class="ruby-keyword kw">return</span>
766:       <span class="ruby-keyword kw">end</span>
767:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bin</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
768:         <span class="ruby-identifier">pos</span> = <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;7FE0,0010&quot;</span>)
769:         <span class="ruby-comment cmt"># Modify element:</span>
770:         <span class="ruby-identifier">set_value</span>(<span class="ruby-identifier">bin</span>, <span class="ruby-value str">&quot;7FE0,0010&quot;</span>, <span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>, <span class="ruby-identifier">:bin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
771:       <span class="ruby-keyword kw">else</span>
772:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-value str">&quot;Content of file is of zero length. Nothing to store.&quot;</span>)
773:       <span class="ruby-keyword kw">end</span>
774:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000037" class="method-detail">
        <a name="M000037"></a>

        <div class="method-heading">
          <a href="#M000037" class="method-signature">
          <span class="method-name">set_image_magick</span><span class="method-args">(magick_obj, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transfers pixel data from a RMagick object to the pixel data element. NB!
Because of rescaling when importing pixel values to a RMagick object, and
the possible difference between presentation values and pixel values, the
use of <a href="DObject.html#M000037">set_image_magick</a>() may result in
pixel data that is completely different from what is expected. This method
should be used only with great care! If value rescaling is wanted, both
:min and :max must be set! Options: :max =&gt; value - Pixel values will be
rescaled using this as the <a href="DObject.html#M000017">new</a> maximum
value. :min =&gt; value - Pixel values will be rescaled, using this as the
<a href="DObject.html#M000017">new</a> minimum value.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000037-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000037-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 786</span>
786:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_image_magick</span>(<span class="ruby-identifier">magick_obj</span>, <span class="ruby-identifier">options</span>={})
787:       <span class="ruby-comment cmt"># Export the RMagick object to a standard Ruby array of numbers:</span>
788:       <span class="ruby-identifier">pixel_array</span> = <span class="ruby-identifier">magick_obj</span>.<span class="ruby-identifier">export_pixels</span>(<span class="ruby-identifier">x</span>=<span class="ruby-value">0</span>, <span class="ruby-identifier">y</span>=<span class="ruby-value">0</span>, <span class="ruby-identifier">columns</span>=<span class="ruby-identifier">magick_obj</span>.<span class="ruby-identifier">columns</span>, <span class="ruby-identifier">rows</span>=<span class="ruby-identifier">magick_obj</span>.<span class="ruby-identifier">rows</span>, <span class="ruby-identifier">map</span>=<span class="ruby-value str">&quot;I&quot;</span>)
789:       <span class="ruby-comment cmt"># Rescale pixel values?</span>
790:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:min</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:max</span>]
791:         <span class="ruby-identifier">p_min</span> = <span class="ruby-identifier">pixel_array</span>.<span class="ruby-identifier">min</span>
792:         <span class="ruby-identifier">p_max</span> = <span class="ruby-identifier">pixel_array</span>.<span class="ruby-identifier">max</span>
793:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_min</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:min</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">p_max</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:max</span>]
794:           <span class="ruby-identifier">wanted_range</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:max</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:min</span>]
795:           <span class="ruby-identifier">factor</span> = <span class="ruby-identifier">wanted_range</span>.<span class="ruby-identifier">to_f</span><span class="ruby-operator">/</span>(<span class="ruby-identifier">pixel_array</span>.<span class="ruby-identifier">max</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">pixel_array</span>.<span class="ruby-identifier">min</span>).<span class="ruby-identifier">to_f</span>
796:           <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">pixel_array</span>.<span class="ruby-identifier">min</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:min</span>]
797:           <span class="ruby-identifier">pixel_array</span>.<span class="ruby-identifier">collect!</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> ((<span class="ruby-identifier">x</span><span class="ruby-operator">*</span><span class="ruby-identifier">factor</span>)<span class="ruby-operator">-</span><span class="ruby-identifier">offset</span>).<span class="ruby-identifier">round</span>}
798:         <span class="ruby-keyword kw">end</span>
799:       <span class="ruby-keyword kw">end</span>
800:       <span class="ruby-comment cmt"># Encode this array using the standard class method:</span>
801:       <span class="ruby-identifier">set_value</span>(<span class="ruby-identifier">pixel_array</span>, <span class="ruby-value str">&quot;7FE0,0010&quot;</span>, <span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
802:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000038" class="method-detail">
        <a name="M000038"></a>

        <div class="method-heading">
          <a href="#M000038" class="method-signature">
          <span class="method-name">set_image_narray</span><span class="method-args">(narray, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transfers pixel data from a NArray object to the pixel data element. If
value rescaling is wanted, both :min and :max must be set! Options: :max
=&gt; value - Pixel values will be rescaled using this as the <a
href="DObject.html#M000017">new</a> maximum value. :min =&gt; value - Pixel
values will be rescaled, using this as the <a
href="DObject.html#M000017">new</a> minimum value.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000038-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000038-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 810</span>
810:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_image_narray</span>(<span class="ruby-identifier">narray</span>, <span class="ruby-identifier">options</span>={})
811:       <span class="ruby-comment cmt"># Rescale pixel values?</span>
812:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:min</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:max</span>]
813:         <span class="ruby-identifier">n_min</span> = <span class="ruby-identifier">narray</span>.<span class="ruby-identifier">min</span>
814:         <span class="ruby-identifier">n_max</span> = <span class="ruby-identifier">narray</span>.<span class="ruby-identifier">max</span>
815:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">n_min</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:min</span>] <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">n_max</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:max</span>]
816:           <span class="ruby-identifier">wanted_range</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:max</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:min</span>]
817:           <span class="ruby-identifier">factor</span> = <span class="ruby-identifier">wanted_range</span>.<span class="ruby-identifier">to_f</span><span class="ruby-operator">/</span>(<span class="ruby-identifier">n_max</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">n_min</span>).<span class="ruby-identifier">to_f</span>
818:           <span class="ruby-identifier">offset</span> = <span class="ruby-identifier">n_min</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:min</span>]
819:           <span class="ruby-identifier">narray</span> = <span class="ruby-identifier">narray</span><span class="ruby-operator">*</span><span class="ruby-identifier">factor</span><span class="ruby-operator">-</span><span class="ruby-identifier">offset</span>
820:         <span class="ruby-keyword kw">end</span>
821:       <span class="ruby-keyword kw">end</span>
822:       <span class="ruby-comment cmt"># Export the NArray object to a standard Ruby array of numbers:</span>
823:       <span class="ruby-identifier">pixel_array</span> = <span class="ruby-identifier">narray</span>.<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">flatten!</span>
824:       <span class="ruby-comment cmt"># Encode this array using the standard class method:</span>
825:       <span class="ruby-identifier">set_value</span>(<span class="ruby-identifier">pixel_array</span>, <span class="ruby-value str">&quot;7FE0,0010&quot;</span>, <span class="ruby-identifier">:create</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
826:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000041" class="method-detail">
        <a name="M000041"></a>

        <div class="method-heading">
          <a href="#M000041" class="method-signature">
          <span class="method-name">set_value</span><span class="method-args">(value, element, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the value of a data element by modifying an existing element or
creating a <a href="DObject.html#M000017">new</a> one. If the supplied
value is not binary, it will attempt to encode the value to binary itself.
Options: :create =&gt; false - Only update the specified element (do not
create if missing). :bin =&gt; bin_data - Value is already encoded as a
binary string. :vr =&gt; string - If creating a private element, the value
representation must be provided to ensure proper encoding. :parent =&gt;
element - If an element is to be created inside a sequence/item, it&#8216;s
parent must be specified to ensure proper placement.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000041-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000041-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 895</span>
895:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_value</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">element</span>, <span class="ruby-identifier">options</span>={})
896:       <span class="ruby-comment cmt"># Options:</span>
897:       <span class="ruby-identifier">bin</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:bin</span>] <span class="ruby-comment cmt"># =true means value already encoded</span>
898:       <span class="ruby-identifier">vr</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:vr</span>] <span class="ruby-comment cmt"># a string which tells us what kind of type an unknown data element is</span>
899:       <span class="ruby-comment cmt"># Retrieve array position:</span>
900:       <span class="ruby-identifier">pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">element</span>, <span class="ruby-identifier">options</span>)
901:       <span class="ruby-comment cmt"># We do not support changing multiple data elements:</span>
902:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
903:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Warning: Method set_value() does not allow an element query (#{element}) which yields multiple array hits. Please use array position instead of tag/name. Value(s) NOT saved.&quot;</span>)
904:         <span class="ruby-keyword kw">return</span>
905:       <span class="ruby-keyword kw">end</span>
906:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:create</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
907:         <span class="ruby-comment cmt"># Since user has requested an element shall only be updated, we can not do so as the element position is not valid:</span>
908:         <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Warning: Invalid data element (#{element}) provided to method set_value(). Value NOT updated.&quot;</span>)
909:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:create</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">false</span>
910:         <span class="ruby-comment cmt"># Modify element:</span>
911:         <span class="ruby-identifier">modify_element</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">pos</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">:bin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bin</span>)
912:       <span class="ruby-keyword kw">else</span>
913:         <span class="ruby-comment cmt"># User wants to create an element (or modify it if it is already present).</span>
914:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
915:           <span class="ruby-comment cmt"># The data element already exist, so we modify instead of creating:</span>
916:           <span class="ruby-identifier">modify_element</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">pos</span>[<span class="ruby-value">0</span>], <span class="ruby-identifier">:bin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bin</span>)
917:         <span class="ruby-keyword kw">else</span>
918:           <span class="ruby-comment cmt"># We need to create element:</span>
919:           <span class="ruby-comment cmt"># In the case that name has been provided instead of a tag, check with the library first:</span>
920:           <span class="ruby-identifier">tag</span> = <span class="ruby-constant">LIBRARY</span>.<span class="ruby-identifier">get_tag</span>(<span class="ruby-identifier">element</span>)
921:           <span class="ruby-comment cmt"># If this doesnt give a match, we may be dealing with a private tag:</span>
922:           <span class="ruby-identifier">tag</span> = <span class="ruby-identifier">element</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">tag</span>
923:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
924:             <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Warning: Invalid data element (#{element}) provided to method set_value(). Value NOT updated.&quot;</span>)
925:           <span class="ruby-keyword kw">else</span>
926:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">element</span>.<span class="ruby-identifier">is_a_tag?</span>
927:               <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Warning: Method set_value could not create data element, because the data element tag (#{element}) is invalid (Expected format of tags is 'GGGG,EEEE').&quot;</span>)
928:             <span class="ruby-keyword kw">else</span>
929:               <span class="ruby-comment cmt"># As we wish to create a new data element, we need to find out where to insert it in the element arrays:</span>
930:               <span class="ruby-comment cmt"># We will do this by finding the array position of the last element that will (alphabetically/numerically) stay in front of this element.</span>
931:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tags</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
932:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:parent</span>]
933:                   <span class="ruby-comment cmt"># Parent specified:</span>
934:                   <span class="ruby-identifier">parent_pos</span> = <span class="ruby-identifier">get_pos</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:parent</span>])
935:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">parent_pos</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
936:                     <span class="ruby-identifier">add_msg</span>(<span class="ruby-node">&quot;Error: Method set_value() could not create data element, because the specified parent element (#{options[:parent]}) returns multiple hits.&quot;</span>)
937:                     <span class="ruby-keyword kw">return</span>
938:                   <span class="ruby-keyword kw">end</span>
939:                   <span class="ruby-identifier">indexes</span> = <span class="ruby-identifier">children</span>(<span class="ruby-identifier">parent_pos</span>, <span class="ruby-identifier">:next_only</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>)
940:                   <span class="ruby-identifier">level</span> = <span class="ruby-ivar">@levels</span>[<span class="ruby-identifier">parent_pos</span>.<span class="ruby-identifier">first</span>]<span class="ruby-operator">+</span><span class="ruby-value">1</span>
941:                 <span class="ruby-keyword kw">else</span>
942:                   <span class="ruby-comment cmt"># No parent (fetch top level elements):</span>
943:                   <span class="ruby-identifier">full_array</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@levels</span>.<span class="ruby-identifier">length</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">i</span>}
944:                   <span class="ruby-identifier">indexes</span> = <span class="ruby-identifier">full_array</span>.<span class="ruby-identifier">all_indices</span>(<span class="ruby-ivar">@levels</span>, <span class="ruby-value">0</span>)
945:                   <span class="ruby-identifier">level</span> = <span class="ruby-value">0</span>
946:                 <span class="ruby-keyword kw">end</span>
947:                 <span class="ruby-comment cmt"># Loop through the selection:</span>
948:                 <span class="ruby-identifier">index</span> = <span class="ruby-value">-1</span>
949:                 <span class="ruby-identifier">quit</span> = <span class="ruby-keyword kw">false</span>
950:                 <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">quit</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">do</span>
951:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">index</span><span class="ruby-operator">+</span><span class="ruby-value">1</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">indexes</span>.<span class="ruby-identifier">length</span> <span class="ruby-comment cmt"># We have reached end of array.</span>
952:                     <span class="ruby-identifier">quit</span> = <span class="ruby-keyword kw">true</span>
953:                   <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">tag</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@tags</span>[<span class="ruby-identifier">indexes</span>[<span class="ruby-identifier">index</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>]]
954:                     <span class="ruby-identifier">quit</span> = <span class="ruby-keyword kw">true</span>
955:                   <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># Increase index in anticipation of a 'hit'.</span>
956:                     <span class="ruby-identifier">index</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
957:                   <span class="ruby-keyword kw">end</span>
958:                 <span class="ruby-keyword kw">end</span>
959:                 <span class="ruby-comment cmt"># Determine the index to pass on:</span>
960:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">==</span> <span class="ruby-value">-1</span>
961:                   <span class="ruby-comment cmt"># Empty parent tag or new tag belongs in front of our indexes:</span>
962:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">indexes</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
963:                     <span class="ruby-identifier">full_index</span> = <span class="ruby-identifier">parent_pos</span>.<span class="ruby-identifier">first</span>
964:                   <span class="ruby-keyword kw">else</span>
965:                     <span class="ruby-identifier">full_index</span> = <span class="ruby-identifier">indexes</span>.<span class="ruby-identifier">first</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>
966:                   <span class="ruby-keyword kw">end</span>
967:                 <span class="ruby-keyword kw">else</span>
968:                   <span class="ruby-identifier">full_index</span> = <span class="ruby-identifier">indexes</span>[<span class="ruby-identifier">index</span>]
969:                 <span class="ruby-keyword kw">end</span>
970:               <span class="ruby-keyword kw">else</span>
971:                 <span class="ruby-comment cmt"># We are dealing with an empty DICOM object:</span>
972:                 <span class="ruby-identifier">full_index</span> = <span class="ruby-keyword kw">nil</span>
973:                 <span class="ruby-identifier">level</span> = <span class="ruby-value">0</span>
974:               <span class="ruby-keyword kw">end</span>
975:               <span class="ruby-comment cmt"># The necessary information is gathered; create new data element:</span>
976:               <span class="ruby-identifier">create_element</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">tag</span>, <span class="ruby-identifier">full_index</span>, <span class="ruby-identifier">level</span>, <span class="ruby-identifier">:bin</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bin</span>, <span class="ruby-identifier">:vr</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">vr</span>)
977:             <span class="ruby-keyword kw">end</span>
978:           <span class="ruby-keyword kw">end</span>
979:         <span class="ruby-keyword kw">end</span>
980:       <span class="ruby-keyword kw">end</span>
981:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">write</span><span class="method-args">(file_name, transfer_syntax = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Transfers necessary information from the <a href="DObject.html">DObject</a>
to the <a href="DWrite.html">DWrite</a> class, which will attempt to <a
href="DObject.html#M000019">write</a> this information to a valid <a
href="../DICOM.html">DICOM</a> file.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DObject.rb, line 120</span>
120:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write</span>(<span class="ruby-identifier">file_name</span>, <span class="ruby-identifier">transfer_syntax</span> = <span class="ruby-keyword kw">nil</span>)
121:       <span class="ruby-identifier">w</span> = <span class="ruby-identifier">set_write_object</span>(<span class="ruby-identifier">file_name</span>, <span class="ruby-identifier">transfer_syntax</span>)
122:       <span class="ruby-identifier">w</span>.<span class="ruby-identifier">write</span>
123:       <span class="ruby-comment cmt"># Write process succesful?</span>
124:       <span class="ruby-ivar">@write_success</span> = <span class="ruby-identifier">w</span>.<span class="ruby-identifier">success</span>
125:       <span class="ruby-comment cmt"># If any messages has been recorded, send these to the message handling method:</span>
126:       <span class="ruby-identifier">add_msg</span>(<span class="ruby-identifier">w</span>.<span class="ruby-identifier">msg</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">w</span>.<span class="ruby-identifier">msg</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
127:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>