<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: DICOM::DServer</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">DICOM::DServer</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/dicom/DServer_rb.html">
                lib/dicom/DServer.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This class contains code for setting up a Service Class Provider (SCP),
which will act as a simple storage node (a server that receives images).
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000007">add_abstract_syntax</a>&nbsp;&nbsp;
      <a href="#M000006">new</a>&nbsp;&nbsp;
      <a href="#M000008">print_syntaxes</a>&nbsp;&nbsp;
      <a href="#M000009">remove_abstract_syntax</a>&nbsp;&nbsp;
      <a href="#M000010">remove_all_abstract_syntaxes</a>&nbsp;&nbsp;
      <a href="#M000005">run</a>&nbsp;&nbsp;
      <a href="#M000011">start_scp</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">errors</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">file_handler</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Accessible attributes:

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">host_ae</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Accessible attributes:

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">max_package_size</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Accessible attributes:

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">notices</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">port</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Accessible attributes:

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">timeout</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Accessible attributes:

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">verbose</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
Accessible attributes:

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000006" class="method-detail">
        <a name="M000006"></a>

        <div class="method-heading">
          <a href="#M000006" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(port=104, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Initialize the instance with a host adress and a port number.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000006-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000006-source">
<pre>
    <span class="ruby-comment cmt"># File lib/dicom/DServer.rb, line 22</span>
22:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">port</span>=<span class="ruby-value">104</span>, <span class="ruby-identifier">options</span>={})
23:       <span class="ruby-identifier">require</span> <span class="ruby-value str">'socket'</span>
24:       <span class="ruby-comment cmt"># Required parameters:</span>
25:       <span class="ruby-ivar">@port</span> = <span class="ruby-identifier">port</span>
26:       <span class="ruby-comment cmt"># Optional parameters (and default values):</span>
27:       <span class="ruby-ivar">@file_handler</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:file_handler</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">FileHandler</span>
28:       <span class="ruby-ivar">@host_ae</span> =  <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:host_ae</span>]  <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;RUBY_DICOM&quot;</span>
29:       <span class="ruby-ivar">@max_package_size</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:max_package_size</span>] <span class="ruby-operator">||</span> <span class="ruby-value">32768</span> <span class="ruby-comment cmt"># 16384</span>
30:       <span class="ruby-ivar">@timeout</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:timeout</span>] <span class="ruby-operator">||</span> <span class="ruby-value">10</span> <span class="ruby-comment cmt"># seconds</span>
31:       <span class="ruby-ivar">@min_length</span> = <span class="ruby-value">12</span> <span class="ruby-comment cmt"># minimum number of bytes to expect in an incoming transmission</span>
32:       <span class="ruby-ivar">@verbose</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:verbose</span>]
33:       <span class="ruby-ivar">@verbose</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@verbose</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># Default verbosity is 'on'.</span>
34:       <span class="ruby-comment cmt"># Other instance variables:</span>
35:       <span class="ruby-ivar">@errors</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment cmt"># errors and warnings are put in this array</span>
36:       <span class="ruby-ivar">@notices</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment cmt"># information on successful transmissions are put in this array</span>
37:       <span class="ruby-comment cmt"># Variables used for monitoring state of transmission:</span>
38:       <span class="ruby-ivar">@connection</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># TCP connection status</span>
39:       <span class="ruby-ivar">@association</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># DICOM Association status</span>
40:       <span class="ruby-ivar">@request_approved</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># Status of our DICOM request</span>
41:       <span class="ruby-ivar">@release</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># Status of received, valid release response</span>
42:       <span class="ruby-identifier">set_valid_abstract_syntaxes</span>
43:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000005" class="method-detail">
        <a name="M000005"></a>

        <div class="method-heading">
          <a href="#M000005" class="method-signature">
          <span class="method-name">run</span><span class="method-args">(port=104, path='./received/', &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Run the server and take a block for initializing.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000005-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000005-source">
<pre>
    <span class="ruby-comment cmt"># File lib/dicom/DServer.rb, line 11</span>
11:     <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">run</span>(<span class="ruby-identifier">port</span>=<span class="ruby-value">104</span>, <span class="ruby-identifier">path</span>=<span class="ruby-value str">'./received/'</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
12:       <span class="ruby-identifier">server</span> = <span class="ruby-constant">DServer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">port</span>)
13:       <span class="ruby-identifier">server</span>.<span class="ruby-identifier">instance_eval</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
14:       <span class="ruby-identifier">server</span>.<span class="ruby-identifier">start_scp</span>(<span class="ruby-identifier">path</span>)
15:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000007" class="method-detail">
        <a name="M000007"></a>

        <div class="method-heading">
          <a href="#M000007" class="method-signature">
          <span class="method-name">add_abstract_syntax</span><span class="method-args">(value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a specified abstract syntax to the list of syntaxes that the server
instance will accept.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000007-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000007-source">
<pre>
    <span class="ruby-comment cmt"># File lib/dicom/DServer.rb, line 47</span>
47:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_abstract_syntax</span>(<span class="ruby-identifier">value</span>)
48:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
49:         <span class="ruby-ivar">@valid_abstract_syntaxes</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
50:         <span class="ruby-ivar">@valid_abstract_syntaxes</span>.<span class="ruby-identifier">sort!</span>
51:       <span class="ruby-keyword kw">else</span>
52:         <span class="ruby-identifier">add_error</span>(<span class="ruby-value str">&quot;Error: The specified abstract syntax is not a string!&quot;</span>)
53:       <span class="ruby-keyword kw">end</span>
54:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000008" class="method-detail">
        <a name="M000008"></a>

        <div class="method-heading">
          <a href="#M000008" class="method-signature">
          <span class="method-name">print_syntaxes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Print the list of valid abstract syntaxes to the screen.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000008-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000008-source">
<pre>
    <span class="ruby-comment cmt"># File lib/dicom/DServer.rb, line 58</span>
58:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">print_syntaxes</span>
59:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Abstract syntaxes accepted by this SCP:&quot;</span>
60:       <span class="ruby-ivar">@valid_abstract_syntaxes</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">syntax</span><span class="ruby-operator">|</span>
61:         <span class="ruby-identifier">puts</span> <span class="ruby-identifier">syntax</span>
62:       <span class="ruby-keyword kw">end</span>
63:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="#M000009" class="method-signature">
          <span class="method-name">remove_abstract_syntax</span><span class="method-args">(value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove a specific abstract syntax from the list of syntaxes that the server
instance will accept.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000009-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000009-source">
<pre>
    <span class="ruby-comment cmt"># File lib/dicom/DServer.rb, line 67</span>
67:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_abstract_syntax</span>(<span class="ruby-identifier">value</span>)
68:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>)
69:         <span class="ruby-comment cmt"># Remove it:</span>
70:         <span class="ruby-ivar">@valid_abstract_syntaxes</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">value</span>)
71:       <span class="ruby-keyword kw">else</span>
72:         <span class="ruby-identifier">add_error</span>(<span class="ruby-value str">&quot;Error: The specified abstract syntax is not a string!&quot;</span>)
73:       <span class="ruby-keyword kw">end</span>
74:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="#M000010" class="method-signature">
          <span class="method-name">remove_all_abstract_syntaxes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Completely clear the list of syntaxes that the server instance will accept.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000010-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000010-source">
<pre>
    <span class="ruby-comment cmt"># File lib/dicom/DServer.rb, line 78</span>
78:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_all_abstract_syntaxes</span>
79:       <span class="ruby-ivar">@valid_abstract_syntaxes</span> = <span class="ruby-constant">Array</span>.<span class="ruby-identifier">new</span>
80:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">start_scp</span><span class="method-args">(path='./received/')</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Start a Service Class Provider (SCP). This service will receive and store
<a href="../DICOM.html">DICOM</a> files in a specified folder.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
     <span class="ruby-comment cmt"># File lib/dicom/DServer.rb, line 84</span>
 84:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">start_scp</span>(<span class="ruby-identifier">path</span>=<span class="ruby-value str">'./received/'</span>)
 85:       <span class="ruby-identifier">add_notice</span>(<span class="ruby-value str">&quot;Starting SCP server...&quot;</span>)
 86:       <span class="ruby-identifier">add_notice</span>(<span class="ruby-value str">&quot;*********************************&quot;</span>)
 87:       <span class="ruby-comment cmt"># Initiate server:</span>
 88:       <span class="ruby-ivar">@scp</span> = <span class="ruby-constant">TCPServer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-ivar">@port</span>)
 89:       <span class="ruby-comment cmt"># Use a loop to listen for incoming messages:</span>
 90:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
 91:         <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span>(<span class="ruby-ivar">@scp</span>.<span class="ruby-identifier">accept</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">session</span><span class="ruby-operator">|</span>
 92:           <span class="ruby-comment cmt"># Initialize the network package handler for this session:</span>
 93:           <span class="ruby-identifier">link</span> = <span class="ruby-constant">Link</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:host_ae</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@host_ae</span>, <span class="ruby-identifier">:max_package_size</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@max_package_size</span>, <span class="ruby-identifier">:timeout</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@timeout</span>, <span class="ruby-identifier">:verbose</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@verbose</span>, <span class="ruby-identifier">:file_handler</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@file_handler</span>)
 94:           <span class="ruby-identifier">add_notice</span>(<span class="ruby-node">&quot;Connection established (name: #{session.peeraddr[2]}, ip: #{session.peeraddr[3]})&quot;</span>)
 95:           <span class="ruby-comment cmt"># Receive an incoming message:</span>
 96:           <span class="ruby-comment cmt">#segments = link.receive_single_transmission(session)</span>
 97:           <span class="ruby-identifier">segments</span> = <span class="ruby-identifier">link</span>.<span class="ruby-identifier">receive_multiple_transmissions</span>(<span class="ruby-identifier">session</span>)
 98:           <span class="ruby-identifier">info</span> = <span class="ruby-identifier">segments</span>.<span class="ruby-identifier">first</span>
 99:           <span class="ruby-comment cmt"># Interpret the received message:</span>
100:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">info</span>[<span class="ruby-identifier">:valid</span>]
101:             <span class="ruby-identifier">association_error</span> = <span class="ruby-identifier">check_association_request</span>(<span class="ruby-identifier">info</span>)
102:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">association_error</span>
103:               <span class="ruby-identifier">syntax_result</span> = <span class="ruby-identifier">check_syntax_requests</span>(<span class="ruby-identifier">link</span>, <span class="ruby-identifier">info</span>)
104:               <span class="ruby-identifier">link</span>.<span class="ruby-identifier">handle_association_accept</span>(<span class="ruby-identifier">session</span>, <span class="ruby-identifier">info</span>, <span class="ruby-identifier">syntax_result</span>)
105:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">syntax_result</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;00&quot;</span> <span class="ruby-comment cmt"># Normal (no error)</span>
106:                 <span class="ruby-identifier">add_notice</span>(<span class="ruby-value str">&quot;An incoming association request and its abstract syntax has been accepted.&quot;</span>)
107:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">info</span>[<span class="ruby-identifier">:abstract_syntax</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;1.2.840.10008.1.1&quot;</span>
108:                   <span class="ruby-comment cmt"># Verification SOP Class (used for testing connections):</span>
109:                   <span class="ruby-identifier">link</span>.<span class="ruby-identifier">handle_release</span>(<span class="ruby-identifier">session</span>)
110:                 <span class="ruby-keyword kw">else</span>
111:                   <span class="ruby-comment cmt"># Process the incoming data:</span>
112:                   <span class="ruby-identifier">success</span>, <span class="ruby-identifier">message</span> = <span class="ruby-identifier">link</span>.<span class="ruby-identifier">handle_incoming_data</span>(<span class="ruby-identifier">session</span>, <span class="ruby-identifier">path</span>)
113:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">success</span>
114:                     <span class="ruby-identifier">add_notice</span>(<span class="ruby-identifier">message</span>)
115:                     <span class="ruby-comment cmt"># Send a receipt for received data:</span>
116:                     <span class="ruby-identifier">link</span>.<span class="ruby-identifier">handle_response</span>(<span class="ruby-identifier">session</span>)
117:                   <span class="ruby-keyword kw">else</span>
118:                     <span class="ruby-comment cmt"># Something has gone wrong:</span>
119:                     <span class="ruby-identifier">add_error</span>(<span class="ruby-identifier">message</span>)
120:                   <span class="ruby-keyword kw">end</span>
121:                   <span class="ruby-comment cmt"># Release the connection:</span>
122:                   <span class="ruby-identifier">link</span>.<span class="ruby-identifier">handle_release</span>(<span class="ruby-identifier">session</span>)
123:                 <span class="ruby-keyword kw">end</span>
124:               <span class="ruby-keyword kw">else</span>
125:                 <span class="ruby-comment cmt"># Abstract syntax in the incoming request was not accepted:</span>
126:                 <span class="ruby-identifier">add_notice</span>(<span class="ruby-node">&quot;An incoming association request was accepted, but it's abstract syntax was rejected. (#{abstract_syntax})&quot;</span>)
127:                 <span class="ruby-comment cmt"># Since the requested abstract syntax was not accepted, the association must be released.</span>
128:                 <span class="ruby-identifier">link</span>.<span class="ruby-identifier">handle_release</span>(<span class="ruby-identifier">session</span>)
129:               <span class="ruby-keyword kw">end</span>
130:             <span class="ruby-keyword kw">else</span>
131:               <span class="ruby-comment cmt"># The incoming association was not formally correct.</span>
132:               <span class="ruby-identifier">link</span>.<span class="ruby-identifier">handle_rejection</span>(<span class="ruby-identifier">session</span>)
133:             <span class="ruby-keyword kw">end</span>
134:           <span class="ruby-keyword kw">else</span>
135:             <span class="ruby-comment cmt"># The incoming message was not recognised as a valid DICOM message. Abort:</span>
136:             <span class="ruby-identifier">link</span>.<span class="ruby-identifier">handle_abort</span>(<span class="ruby-identifier">session</span>)
137:           <span class="ruby-keyword kw">end</span>
138:           <span class="ruby-comment cmt"># Terminate the connection:</span>
139:           <span class="ruby-identifier">session</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>.<span class="ruby-identifier">closed?</span>
140:           <span class="ruby-identifier">add_notice</span>(<span class="ruby-value str">&quot;Connection closed.&quot;</span>)
141:           <span class="ruby-identifier">add_notice</span>(<span class="ruby-value str">&quot;*********************************&quot;</span>)
142:         <span class="ruby-keyword kw">end</span>
143:       <span class="ruby-keyword kw">end</span>
144:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>